- name: Create Nginx SSL directory
  file:
    mode: '0700'
    path: "{{ nginx_path }}/ssl"
    state: directory

- name: Generate strong unique Diffie-Hellman group
  command: openssl dhparam -out dhparams.pem 2048
  args:
    chdir: "{{ nginx_path }}/ssl"
    creates: "{{ nginx_path }}/ssl/dhparams.pem"
  notify: reload nginx
  tags: [diffie-hellman, ssl, wordpress, wordpress-setup, nginx-includes, nginx-sites]

- include_tasks:
    file: acme.yml
  when:
    - sites_using_acme_ssl | count

- include_tasks:
    file: manual.yml
  when:
    - sites_using_manual_ssl | count
